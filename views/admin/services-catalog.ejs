<%
  const formatCurrency = (cents) => {
    if (cents === null || cents === undefined) return '—'
    return new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR' }).format(cents / 100)
  }

  const getServiceTypeLabel = (type) => {
    const labels = {
      'one_time': 'Eenmalig',
      'recurring': 'Terugkerend',
      'per_lead': 'Per lead',
      'hourly': 'Per uur'
    }
    return labels[type] || type
  }

  const getStatusLabel = (status) => {
    const labels = {
      'active': 'Actief',
      'inactive': 'Inactief',
      'archived': 'Gearchiveerd'
    }
    return labels[status] || status
  }

  const getStatusBadgeClass = (status) => {
    const classes = {
      'active': 'badge-success',
      'inactive': 'badge-warning',
      'archived': 'badge-secondary'
    }
    return classes[status] || 'badge-secondary'
  }
%>
<%- include('../layouts/admin', {
  title: 'Diensten Catalogus',
  activeMenu: 'services',
  activeSubmenu: 'catalog',
  user: user,
  stylesheets: ['/css/admin/tasks.css'],
  scripts: ['/js/admin/services-catalog.js'],
  body: (function() {
    var output = '';
    output += '<style>';
    output += '.badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500; }';
    output += '.badge-success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }';
    output += '.badge-warning { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }';
    output += '.badge-secondary { background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; }';
    output += '.btn-primary { background: #ea5d0d; color: white; border: none; padding: 0.625rem 1.25rem; border-radius: 6px; cursor: pointer; font-weight: 500; }';
    output += '.btn-primary:hover { background: #d14d0b; }';
    output += '.modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; }';
    output += '.modal-content { background-color: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }';
    output += '.modal-header { padding: 1.5rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }';
    output += '.modal-header h2 { margin: 0; font-size: 1.25rem; font-weight: 600; }';
    output += '.modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; }';
    output += '.modal-close:hover { color: #111827; }';
    output += '.modal-footer { padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 12px; }';
    output += '</style>';
    output += '<div class="services-catalog-container">';
    
    // Page Header
    output += '  <div class="page-header">';
    output += '    <div>';
    output += '      <h1>Diensten Catalogus</h1>';
    output += '      <p class="text-muted">Beheer alle diensten in de catalogus</p>';
    output += '    </div>';
    output += '    <div class="header-actions" style="margin-bottom:16px; display: flex; gap: 12px;">';
    if (typeof isUserAdmin !== 'undefined' && isUserAdmin) {
      output += '      <button id="addServiceBtn" class="btn-primary">';
      output += '        <i class="fas fa-plus"></i> Nieuwe dienst';
      output += '      </button>';
    }
    output += '    </div>';
    output += '  </div>';
    
    // Services Grid/Cards
    output += '  <div class="services-catalog-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">';
    
    if (typeof services !== 'undefined' && services && services.length > 0) {
      services.forEach(function(service) {
        const marginCents = (service.price_cents && service.cost_cents !== null) ? (service.price_cents - service.cost_cents) : null;
        const marginPercent = (service.price_cents && service.cost_cents !== null && service.price_cents > 0) 
          ? ((marginCents / service.price_cents) * 100) 
          : null;
        
        output += '    <div class="service-card" style="background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s;" data-service-id="' + service.id + '">';
        output += '      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">';
        output += '        <div style="flex: 1;">';
        output += '          <h3 style="margin: 0 0 0.5rem 0; font-size: 1.125rem; font-weight: 600; color: #111827;">' + (service.name || '—') + '</h3>';
        output += '          <span class="badge ' + getStatusBadgeClass(service.status) + '">' + getStatusLabel(service.status) + '</span>';
        output += '        </div>';
        if (typeof isUserAdmin !== 'undefined' && isUserAdmin) {
          output += '        <div style="display: flex; gap: 4px;">';
          output += '          <button class="btn-edit" data-service-id="' + service.id + '" style="padding: 0.375rem; background: #f3f4f6; border: none; border-radius: 4px; cursor: pointer; color: #374151;" title="Bewerken">';
          output += '            <i class="fas fa-edit"></i>';
          output += '          </button>';
          if (service.status !== 'archived') {
            output += '          <button class="btn-archive" data-service-id="' + service.id + '" style="padding: 0.375rem; background: #fef3c7; border: none; border-radius: 4px; cursor: pointer; color: #92400e;" title="Archiveren">';
            output += '            <i class="fas fa-archive"></i>';
            output += '          </button>';
          }
          output += '        </div>';
        }
        output += '      </div>';
        
        if (service.description) {
          output += '      <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 0.875rem; line-height: 1.5;">' + service.description.substring(0, 100) + (service.description.length > 100 ? '...' : '') + '</p>';
        }
        
        output += '      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: #f9fafb; border-radius: 8px;">';
        output += '        <div>';
        output += '          <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Type</div>';
        output += '          <div style="font-weight: 500; color: #111827;">' + getServiceTypeLabel(service.service_type) + '</div>';
        output += '        </div>';
        output += '        <div>';
        output += '          <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Verkoopprijs</div>';
        output += '          <div style="font-weight: 600; color: #111827; font-size: 1.125rem;">' + formatCurrency(service.price_cents) + '</div>';
        output += '        </div>';
        if (typeof isUserAdmin !== 'undefined' && isUserAdmin) {
          output += '        <div>';
          output += '          <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Inkoopkost</div>';
          output += '          <div style="font-weight: 500; color: #111827;">' + formatCurrency(service.cost_cents) + '</div>';
          output += '        </div>';
          output += '        <div>';
          output += '          <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">Marge</div>';
          output += '          <div style="font-weight: 500; color: #111827;">' + formatCurrency(marginCents) + ' (' + (marginPercent ? marginPercent.toFixed(1) : '—') + '%)</div>';
          output += '        </div>';
        }
        output += '      </div>';
        
        if (service.unit_label) {
          output += '      <div style="font-size: 0.75rem; color: #6b7280;">';
          output += '        <i class="fas fa-tag"></i> ' + service.unit_label;
          output += '      </div>';
        }
        
        output += '    </div>';
      });
    } else {
      output += '    <div style="grid-column: 1 / -1; padding: 3rem; text-align: center; color: #6b7280;">';
      output += '      <div style="font-size: 3rem; color: #d1d5db; margin-bottom: 1rem;">';
      output += '        <i class="fas fa-box-open"></i>';
      output += '      </div>';
      output += '      <h3 style="margin: 0 0 0.5rem 0; color: #374151;">Geen diensten</h3>';
      output += '      <p style="color: #6b7280; margin: 0 0 1.5rem 0;">Maak je eerste dienst aan om te beginnen.</p>';
      if (typeof isUserAdmin !== 'undefined' && isUserAdmin) {
        output += '      <button id="addServiceBtnEmpty" class="btn-primary" style="padding: 0.625rem 1.25rem;">';
        output += '        <i class="fas fa-plus"></i> Maak je eerste dienst aan';
        output += '      </button>';
      }
      output += '    </div>';
    }
    
    output += '  </div>';
    
    // Search and Filters
    output += '  <div style="margin-top: 1.5rem; padding: 1.5rem; background: white; border: 1px solid #e5e7eb; border-radius: 12px;">';
    output += '    <div style="display: flex; gap: 12px; flex-wrap: wrap;">';
    output += '      <div style="flex: 1; min-width: 200px;">';
    output += '        <input type="text" id="searchServices" placeholder="Zoek op naam of slug..." value="' + ((typeof filters !== 'undefined' && filters.search) ? filters.search : '') + '" style="width: 100%; padding: 0.625rem 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem;" />';
    output += '      </div>';
    output += '      <select id="statusFilter" style="padding: 0.625rem 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem; background: white;">';
    output += '        <option value="all"' + ((typeof filters !== 'undefined' && filters.status === 'all') ? ' selected' : '') + '>Alle statussen</option>';
    output += '        <option value="active"' + ((typeof filters !== 'undefined' && filters.status === 'active') ? ' selected' : '') + '>Actief</option>';
    output += '        <option value="inactive"' + ((typeof filters !== 'undefined' && filters.status === 'inactive') ? ' selected' : '') + '>Inactief</option>';
    if (typeof isUserAdmin !== 'undefined' && isUserAdmin) {
      output += '        <option value="archived"' + ((typeof filters !== 'undefined' && filters.status === 'archived') ? ' selected' : '') + '>Gearchiveerd</option>';
    }
    output += '      </select>';
    output += '      <select id="typeFilter" style="padding: 0.625rem 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.875rem; background: white;">';
    output += '        <option value="all"' + ((typeof filters !== 'undefined' && filters.type === 'all') ? ' selected' : '') + '>Alle types</option>';
    output += '        <option value="one_time"' + ((typeof filters !== 'undefined' && filters.type === 'one_time') ? ' selected' : '') + '>Eenmalig</option>';
    output += '        <option value="recurring"' + ((typeof filters !== 'undefined' && filters.type === 'recurring') ? ' selected' : '') + '>Terugkerend</option>';
    output += '        <option value="per_lead"' + ((typeof filters !== 'undefined' && filters.type === 'per_lead') ? ' selected' : '') + '>Per lead</option>';
    output += '        <option value="hourly"' + ((typeof filters !== 'undefined' && filters.type === 'hourly') ? ' selected' : '') + '>Per uur</option>';
    output += '      </select>';
    output += '    </div>';
    output += '  </div>';
    
    output += '</div>';
    
    // Service Modal (same as main services page)
    output += '<div id="serviceModal" class="modal" style="display: none;">';
    output += '  <div class="modal-content" style="max-width: 600px;">';
    output += '    <div class="modal-header">';
    output += '      <h2 id="modalTitle">Nieuwe dienst</h2>';
    output += '      <button class="modal-close" id="modalClose">&times;</button>';
    output += '    </div>';
    output += '    <form id="serviceForm">';
    output += '      <div class="modal-body" style="padding: 1.5rem;">';
    output += '        <input type="hidden" id="serviceId" name="id" />';
    output += '        <div style="margin-bottom: 1rem;">';
    output += '          <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Naam *</label>';
    output += '          <input type="text" id="serviceName" name="name" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px;" />';
    output += '        </div>';
    output += '        <div style="margin-bottom: 1rem;">';
    output += '          <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Slug *</label>';
    output += '          <input type="text" id="serviceSlug" name="slug" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px;" />';
    output += '          <p style="margin-top: 0.25rem; font-size: 0.75rem; color: #6b7280;">URL-vriendelijke identifier (bijv. website-ontwikkeling)</p>';
    output += '        </div>';
    output += '        <div style="margin-bottom: 1rem;">';
    output += '          <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Type *</label>';
    output += '          <select id="serviceType" name="service_type" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; background: white;">';
    output += '            <option value="one_time">Eenmalig</option>';
    output += '            <option value="recurring">Terugkerend</option>';
    output += '            <option value="per_lead">Per lead</option>';
    output += '            <option value="hourly">Per uur</option>';
    output += '          </select>';
    output += '        </div>';
    output += '        <div style="margin-bottom: 1rem;">';
    output += '          <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Status *</label>';
    output += '          <select id="serviceStatus" name="status" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; background: white;">';
    output += '            <option value="active">Actief</option>';
    output += '            <option value="inactive">Inactief</option>';
    output += '            <option value="archived">Gearchiveerd</option>';
    output += '          </select>';
    output += '        </div>';
    output += '        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">';
    output += '          <div>';
    output += '            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Verkoopprijs (€) *</label>';
    output += '            <input type="number" id="servicePrice" name="price_cents" step="0.01" min="0" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px;" />';
    output += '          </div>';
    output += '          <div>';
    output += '            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Inkoopkost (€) *</label>';
    output += '            <input type="number" id="serviceCost" name="cost_cents" step="0.01" min="0" required style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px;" />';
    output += '          </div>';
    output += '        </div>';
    output += '        <div style="margin-bottom: 1rem;">';
    output += '          <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Unit label</label>';
    output += '          <input type="text" id="serviceUnitLabel" name="unit_label" placeholder="bijv. lead, maand, uur, project" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px;" />';
    output += '        </div>';
    output += '        <div style="margin-bottom: 1rem;">';
    output += '          <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Beschrijving</label>';
    output += '          <textarea id="serviceDescription" name="description" rows="3" style="width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 6px; resize: vertical;"></textarea>';
    output += '        </div>';
    output += '        <div id="serviceFormError" style="display: none; padding: 0.75rem; background: #fee2e2; border: 1px solid #fecaca; border-radius: 6px; color: #b91c1c; margin-bottom: 1rem;"></div>';
    output += '      </div>';
    output += '      <div class="modal-footer" style="padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 12px;">';
    output += '        <button type="button" class="btn-secondary" id="modalCancel">Annuleren</button>';
    output += '        <button type="submit" class="btn-primary">Opslaan</button>';
    output += '      </div>';
    output += '    </form>';
    output += '  </div>';
    output += '</div>';
    
    return output;
  })()
}) %>

