<%
  const formatDate = (iso) => {
    if (!iso) return '-'
    const d = new Date(iso)
    return d.toLocaleDateString('nl-NL', { day: '2-digit', month: 'short', year: 'numeric' })
  }

  const getStatusClass = (status) => {
    const map = { 
      open: 'status-blue', 
      in_progress: 'status-orange', 
      fixed: 'status-success', 
      closed: 'status-gray' 
    }
    return map[status] || 'status-gray'
  }

  const getStatusLabel = (status) => {
    const map = { 
      open: 'Open', 
      in_progress: 'In behandeling', 
      fixed: 'Gefixt', 
      closed: 'Gesloten' 
    }
    return map[status] || 'Open'
  }

  const getPriorityClass = (priority) => {
    const map = { 
      low: 'status-gray', 
      normal: 'status-blue', 
      high: 'status-orange', 
      urgent: 'status-red' 
    }
    return map[priority] || 'status-gray'
  }

  const getPriorityLabel = (priority) => {
    const map = { 
      low: 'Laag', 
      normal: 'Normaal', 
      high: 'Hoog', 
      urgent: 'Urgent' 
    }
    return map[priority] || 'Normaal'
  }

  const getPriorityColor = (priority) => {
    const map = {
      low: '#6b7280',
      normal: '#3b82f6',
      high: '#f59e0b',
      urgent: '#ef4444'
    }
    return map[priority] || '#6b7280'
  }

  // Group bugs by status for Kanban columns
  const bugsByStatus = {
    open: bugs.filter(b => b.status === 'open'),
    in_progress: bugs.filter(b => b.status === 'in_progress'),
    fixed: bugs.filter(b => b.status === 'fixed'),
    closed: bugs.filter(b => b.status === 'closed')
  }

  const renderBugCard = (bug = {}) => {
    const priorityColor = getPriorityColor(bug.priority || 'normal');
    const priorityLabel = getPriorityLabel(bug.priority || 'normal');
    const priorityBadge = '<span class="bug-priority-badge" style="background-color: ' + priorityColor + '20; color: ' + priorityColor + '; border-color: ' + priorityColor + '40;">' + priorityLabel + '</span>';
    
    const tagsHtml = (bug.tags || []).slice(0, 3).map(tag => 
      '<span class="bug-tag">' + tag + '</span>'
    ).join('')
    
    const createdDate = formatDate(bug.created_at)
    
    const bugUuid = bug.uuid || bug.id;
    const bugId = bug.bug_id || bug.id || 'BUG-000';
    
    const bugDataJson = JSON.stringify(bug).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    const bugStatus = bug.status || 'open';
    const bugPriority = bug.priority || 'normal';
    const bugTitle = bug.title || 'Geen titel';
    const bugDescription = bug.description ? (bug.description.length > 100 ? bug.description.substring(0, 100) + '...' : bug.description) : '';
    const bugArea = bug.area || '';
    const bugCreatedDate = bug.created_at ? createdDate : '';
    
    return (
      '<div class="bug-card" draggable="true" data-bug-id="' + bugId + '" data-bug-uuid="' + bugUuid + '" data-status="' + bugStatus + '" data-priority="' + bugPriority + '" data-bug-data="' + bugDataJson + '">' +
        '<div class="bug-card-header">' +
          '<div class="bug-card-id">' + bugId + '</div>' +
          priorityBadge +
        '</div>' +
        '<h3 class="bug-card-title">' + bugTitle + '</h3>' +
        (bugDescription ? '<p class="bug-card-description">' + bugDescription + '</p>' : '') +
        (tagsHtml ? '<div class="bug-tags">' + tagsHtml + '</div>' : '') +
        '<div class="bug-card-footer">' +
          (bugArea ? '<div class="bug-meta-item"><i class="fas fa-map-marker-alt"></i><span>' + bugArea + '</span></div>' : '') +
          (bugCreatedDate ? '<div class="bug-meta-item"><i class="fas fa-calendar"></i><span>' + bugCreatedDate + '</span></div>' : '') +
        '</div>' +
      '</div>'
    );
  }
%>

<%- include('../layouts/admin', {
  title: 'Bugs',
  activeMenu: 'settings',
  activeSubmenu: 'bugs',
  user: user,
  body: `
  <div class="opportunities-container">
    <!-- Page Header -->
    <div class="page-header">
      <div>
        <h1>Bugs</h1>
        <p class="text-muted">Beheer bugs met drag-and-drop Kanban board</p>
      </div>
      <div class="header-actions">
        <button id="createBugBtn" class="btn-primary">
          <i class="fas fa-plus"></i> Nieuwe Bug
        </button>
      </div>
    </div>
    
    <!-- KPI Cards -->
    <div class="kpi-cards-container">
      <div class="kpi-cards-grid">
        <div class="kpi-card">
          <div class="kpi-content">
            <p class="kpi-title">Totaal</p>
            <p class="kpi-value">${bugs.filter(b => b.status !== 'fixed' && b.status !== 'closed').length}</p>
            <p class="kpi-subtitle">Openstaande bugs</p>
          </div>
          <div class="kpi-icon">
            <i class="fas fa-bug" style="color: #ea5d0d;"></i>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-content">
            <p class="kpi-title">Urgent</p>
            <p class="kpi-value" style="color: #ef4444;">${bugs.filter(b => b.priority === 'urgent' && b.status !== 'fixed' && b.status !== 'closed').length}</p>
            <p class="kpi-subtitle">Urgente bugs</p>
          </div>
          <div class="kpi-icon">
            <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-content">
            <p class="kpi-title">In behandeling</p>
            <p class="kpi-value" style="color: #f59e0b;">${bugs.filter(b => b.status === 'in_progress').length}</p>
            <p class="kpi-subtitle">Wordt gefixt</p>
          </div>
          <div class="kpi-icon">
            <i class="fas fa-spinner" style="color: #f59e0b;"></i>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-content">
            <p class="kpi-title">Gefixt</p>
            <p class="kpi-value" style="color: #10b981;">${bugs.filter(b => b.status === 'fixed').length}</p>
            <p class="kpi-subtitle">Opgelost</p>
          </div>
          <div class="kpi-icon">
            <i class="fas fa-check-circle" style="color: #10b981;"></i>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Kanban Board -->
    <div class="kanban-board">
      <!-- Open Column -->
      <div class="kanban-column" data-status="open">
        <div class="kanban-column-header">
          <h3 class="kanban-column-title">
            <span class="kanban-column-icon" style="background: #3b82f6;">${bugsByStatus.open.length}</span>
            Open
          </h3>
        </div>
        <div class="kanban-column-body">
          ${bugsByStatus.open.length > 0 ? bugsByStatus.open.map(renderBugCard).join('') : '<div class="kanban-empty">Geen bugs</div>'}
        </div>
      </div>
      
      <!-- In Progress Column -->
      <div class="kanban-column" data-status="in_progress">
        <div class="kanban-column-header">
          <h3 class="kanban-column-title">
            <span class="kanban-column-icon" style="background: #f59e0b;">${bugsByStatus.in_progress.length}</span>
            In Behandeling
          </h3>
        </div>
        <div class="kanban-column-body">
          ${bugsByStatus.in_progress.length > 0 ? bugsByStatus.in_progress.map(renderBugCard).join('') : '<div class="kanban-empty">Geen bugs</div>'}
        </div>
      </div>
      
      <!-- Fixed Column -->
      <div class="kanban-column" data-status="fixed">
        <div class="kanban-column-header">
          <h3 class="kanban-column-title">
            <span class="kanban-column-icon" style="background: #10b981;">${bugsByStatus.fixed.length}</span>
            Gefixt
          </h3>
        </div>
        <div class="kanban-column-body">
          ${bugsByStatus.fixed.length > 0 ? bugsByStatus.fixed.map(renderBugCard).join('') : '<div class="kanban-empty">Geen bugs</div>'}
        </div>
      </div>
      
      <!-- Closed Column -->
      <div class="kanban-column" data-status="closed">
        <div class="kanban-column-header">
          <h3 class="kanban-column-title">
            <span class="kanban-column-icon" style="background: #6b7280;">${bugsByStatus.closed.length}</span>
            Gesloten
          </h3>
        </div>
        <div class="kanban-column-body">
          ${bugsByStatus.closed.length > 0 ? bugsByStatus.closed.map(renderBugCard).join('') : '<div class="kanban-empty">Geen bugs</div>'}
        </div>
      </div>
    </div>
  </div>
  
  <style>
    .kanban-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 24px;
      padding: 0;
    }
    
    .kanban-column {
      background: #f9fafb;
      border-radius: 12px;
      padding: 16px;
      min-height: 500px;
      display: flex;
      flex-direction: column;
    }
    
    .kanban-column-header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .kanban-column-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .kanban-column-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 6px;
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    
    .kanban-column-body {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 100px;
      transition: background-color 0.2s;
      position: relative;
    }
    
    .kanban-column-body.drag-over {
      background-color: rgba(234, 93, 13, 0.1);
      border: 2px dashed #ea5d0d;
      border-radius: 8px;
    }
    
    .kanban-empty {
      text-align: center;
      color: #9ca3af;
      font-size: 14px;
      padding: 40px 20px;
      border: 2px dashed #e5e7eb;
      border-radius: 8px;
    }
    
    .bug-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 16px;
      cursor: grab;
      transition: all 0.2s ease;
      position: relative;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    
    .bug-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateY(-2px);
      border-color: #ea5d0d;
      cursor: grab;
    }
    
    .bug-card:active {
      cursor: grabbing;
    }
    
    .bug-card.dragging {
      opacity: 0.5;
      transform: rotate(3deg);
      cursor: grabbing;
    }
    
    .bug-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .bug-card-id {
      font-size: 12px;
      font-weight: 600;
      color: #6b7280;
    }
    
    .bug-priority-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      border: 1px solid;
    }
    
    .bug-card-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
      margin: 0 0 8px 0;
      line-height: 1.4;
    }
    
    .bug-card-description {
      font-size: 12px;
      color: #6b7280;
      line-height: 1.5;
      margin: 0 0 12px 0;
    }
    
    .bug-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }
    
    .bug-tag {
      display: inline-block;
      background-color: #f3f4f6;
      color: #6b7280;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 500;
    }
    
    .bug-card-footer {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #f3f4f6;
    }
    
    .bug-meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #6b7280;
    }
    
    .bug-meta-item i {
      font-size: 10px;
      width: 12px;
    }
    
    
    /* Modal styles */
    .bug-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    
    .bug-modal.active {
      display: flex;
    }
    
    .bug-modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 700px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
    }
    
    .bug-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .bug-modal-title {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }
    
    .bug-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: background 0.2s;
    }
    
    .bug-modal-close:hover {
      background: #f3f4f6;
    }
    
    .bug-detail-section {
      margin-bottom: 20px;
    }
    
    .bug-detail-label {
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      display: block;
    }
    
    .bug-detail-value {
      color: #6b7280;
      line-height: 1.6;
    }
    
    .bug-detail-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    /* Status badge pills in modal */
    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid transparent;
      text-decoration: none;
      line-height: 1;
    }
    
    .bug-modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }
    
    .btn-secondary {
      padding: 10px 20px;
      border: 1px solid #d1d5db;
      background: white;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      color: #374151;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .btn-secondary:hover {
      background: #f9fafb;
      border-color: #9ca3af;
    }
    
    .btn-primary {
      padding: 10px 20px;
      background: #ea5d0d;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .btn-primary:hover {
      background: #cf4a09;
    }
    
    .btn-primary i {
      margin-right: 6px;
    }
    
    .btn-danger {
      padding: 10px 20px;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
    }
    
    .btn-danger i {
      margin-right: 6px;
    }
    
    /* Confirmation Modal */
    .confirm-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 10001;
      align-items: center;
      justify-content: center;
    }
    
    .confirm-modal.active {
      display: flex;
    }
    
    .confirm-modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
    }
    
    .confirm-modal-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .confirm-modal-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #fee2e2;
      color: #dc2626;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }
    
    .confirm-modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
      margin: 0;
    }
    
    .confirm-modal-message {
      color: #6b7280;
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    .confirm-modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
    
    @media (max-width: 1400px) {
      .kanban-board {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .kanban-board {
        grid-template-columns: 1fr;
      }
    }
  </style>
  
  <script>
    let draggedBug = null;
    let draggedBugData = null;
    let isDragging = false;
    
    // Drag start - use event delegation
    document.addEventListener('dragstart', (e) => {
      const bugCard = e.target.closest('.bug-card');
      if (bugCard && bugCard.draggable) {
        isDragging = true;
        draggedBug = bugCard;
        draggedBugData = {
          uuid: bugCard.dataset.bugUuid,
          bugId: bugCard.dataset.bugId,
          status: bugCard.dataset.status
        };
        bugCard.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', bugCard.dataset.bugUuid || bugCard.dataset.bugId);
        console.log('Drag started', draggedBugData);
      }
    });
    
    // Drag end
    document.addEventListener('dragend', (e) => {
      const bugCard = e.target.closest('.bug-card');
      if (bugCard) {
        bugCard.classList.remove('dragging');
        // Remove drag-over class from all columns
        document.querySelectorAll('.kanban-column-body').forEach(col => {
          col.classList.remove('drag-over');
        });
      }
      // Reset after a short delay to allow drop to complete
      setTimeout(() => {
        draggedBug = null;
        draggedBugData = null;
        isDragging = false;
      }, 100);
    });
    
    // Drag over handler
    function handleDragOver(e) {
      // ALWAYS prevent default to allow drop
      e.preventDefault();
      e.stopPropagation();
      
      if (!isDragging) {
        return false;
      }
      
      if (e.dataTransfer) {
        e.dataTransfer.dropEffect = 'move';
      }
      
      const dropZone = e.currentTarget || e.target.closest('.kanban-column-body');
      if (dropZone && dropZone.classList.contains('kanban-column-body')) {
        dropZone.classList.add('drag-over');
      }
      return false;
    }
    
    // Drop handler
    async function handleDrop(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const dropTarget = e.currentTarget || e.target.closest('.kanban-column-body');
      if (!dropTarget || !dropTarget.classList.contains('kanban-column-body')) {
        console.warn('Invalid drop target:', dropTarget);
        return;
      }
      
      dropTarget.classList.remove('drag-over');
      
      console.log('Drop event triggered', { draggedBug, draggedBugData, dropTarget });
      
      if (!draggedBugData && !draggedBug) {
        // Try to get from dataTransfer as fallback
        const bugUuid = e.dataTransfer.getData('text/plain');
        if (!bugUuid) {
          console.warn('No dragged bug data found');
          return;
        }
        // Try to find the bug card by UUID
        const bugCard = document.querySelector('[data-bug-uuid="' + bugUuid + '"]');
        if (bugCard) {
          draggedBug = bugCard;
          draggedBugData = {
            uuid: bugCard.dataset.bugUuid,
            bugId: bugCard.dataset.bugId,
            status: bugCard.dataset.status
          };
        } else {
          draggedBugData = { uuid: bugUuid };
        }
      }
      
      const targetColumn = dropTarget.closest('.kanban-column');
      if (!targetColumn) {
        console.error('No target column found');
        return;
      }
      
      const newStatus = targetColumn.dataset.status;
      if (!newStatus) {
        console.error('No status found on target column');
        return;
      }
      
      const bugCard = draggedBug || document.querySelector('[data-bug-uuid="' + (((draggedBugData && (draggedBugData.uuid || draggedBugData.bugId)) || '')) + '"]');
      if (!bugCard) {
        console.error('No bug card found');
        return;
      }
      
      const oldStatus = bugCard.dataset.status;
      
      if (newStatus === oldStatus) {
        console.log('Same status, no change needed');
        return;
      }
      
      const bugUuid = bugCard.dataset.bugUuid || bugCard.dataset.bugId;
      
      if (!bugUuid) {
        console.error('No bug UUID found');
        return;
      }
      
      // Store original position for rollback (BEFORE moving)
      const originalColumn = bugCard.closest('.kanban-column');
      const originalColumnBody = originalColumn ? originalColumn.querySelector('.kanban-column-body') : null;
      
      // INSTANT: Move card visually immediately (optimistic update)
      bugCard.dataset.status = newStatus;
      dropTarget.appendChild(bugCard);
      updateColumnCounts();
      
      // Update in background (non-blocking)
      try {
        const apiUrl = '/admin/api/bugs/' + bugUuid;
        const response = await fetch(apiUrl, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ status: newStatus })
        });
        
        const result = await response.json();
        
        if (!result.success) {
          // Rollback on error
          if (bugCard && originalColumnBody) {
            originalColumnBody.appendChild(bugCard);
            bugCard.dataset.status = oldStatus;
            updateColumnCounts();
          }
          showToast('error', 'Fout bij verplaatsen', result.error || 'Onbekende fout');
        } else {
          const statusLabel = getStatusLabel(newStatus);
          showToast('success', 'Bug verplaatst', 'Bug verplaatst naar ' + statusLabel);
        }
      } catch (error) {
        console.error('Error updating bug:', error);
        // Rollback on error
        if (bugCard && originalColumnBody) {
          originalColumnBody.appendChild(bugCard);
          bugCard.dataset.status = oldStatus;
          updateColumnCounts();
        }
        showToast('error', 'Fout bij verplaatsen', error.message);
      }
    }
    
    // Drag leave
    document.addEventListener('dragleave', (e) => {
      if (e.target.classList.contains('kanban-column-body')) {
        e.target.classList.remove('drag-over');
      }
    });
    
    // Make handlers globally available
    window.handleDragOver = handleDragOver;
    window.handleDrop = handleDrop;
    
    // Setup drop zones programmatically
    function setupDropZones() {
      const dropZones = document.querySelectorAll('.kanban-column-body');
      console.log('Setting up drop zones:', dropZones.length);
      
      dropZones.forEach(body => {
        // Remove existing listeners if any (by cloning without listeners)
        const hasListeners = body.hasAttribute('data-drop-zone-setup');
        if (!hasListeners) {
          // Add fresh listeners with capture phase to ensure they fire
          body.addEventListener('dragover', handleDragOver, true);
          body.addEventListener('drop', handleDrop, true);
          body.addEventListener('dragleave', (e) => {
            if (e.target === body || !body.contains(e.relatedTarget)) {
              body.classList.remove('drag-over');
            }
          }, true);
          body.setAttribute('data-drop-zone-setup', 'true');
          console.log('Drop zone setup for:', body);
        }
      });
    }
    
    // Setup when DOM is ready
    function initDropZones() {
      try {
        setupDropZones();
      } catch (e) {
        console.error('Error setting up drop zones:', e);
      }
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initDropZones);
    } else {
      initDropZones();
    }
    
    // Also try after delays as fallback
    setTimeout(initDropZones, 100);
    setTimeout(initDropZones, 500);
    
    function updateColumnCounts() {
      document.querySelectorAll('.kanban-column').forEach(column => {
        const columnBody = column.querySelector('.kanban-column-body');
        const count = column.querySelectorAll('.bug-card').length;
        const icon = column.querySelector('.kanban-column-icon');
        const emptyPlaceholder = columnBody.querySelector('.kanban-empty');
        
        if (icon) icon.textContent = count;
        
        // Show/hide empty placeholder
        if (count > 0 && emptyPlaceholder) {
          emptyPlaceholder.remove();
        } else if (count === 0 && !emptyPlaceholder) {
          const emptyDiv = document.createElement('div');
          emptyDiv.className = 'kanban-empty';
          emptyDiv.textContent = 'Geen bugs';
          columnBody.appendChild(emptyDiv);
        }
      });
      updateKPICards();
    }
    
    function updateKPICards() {
      const allBugs = Array.from(document.querySelectorAll('.bug-card'));
      const total = allBugs.filter(card => {
        const status = card.dataset.status;
        return status !== 'fixed' && status !== 'closed';
      }).length;
      const urgent = allBugs.filter(card => {
        const priority = card.dataset.priority;
        const status = card.dataset.status;
        return priority === 'urgent' && status !== 'fixed' && status !== 'closed';
      }).length;
      const inProgress = allBugs.filter(card => card.dataset.status === 'in_progress').length;
      const fixed = allBugs.filter(card => card.dataset.status === 'fixed').length;
      
      const kpiValues = document.querySelectorAll('.kpi-value');
      if (kpiValues.length >= 4) {
        kpiValues[0].textContent = total;
        kpiValues[1].textContent = urgent;
        kpiValues[2].textContent = inProgress;
        kpiValues[3].textContent = fixed;
      }
    }
    
    // Click on bug card to show details
    document.addEventListener('click', (e) => {
      // Don't show modal if we just finished dragging
      if (isDragging) {
        isDragging = false;
        return;
      }
      
      const bugCard = e.target.closest('.bug-card');
      if (bugCard && !bugCard.classList.contains('dragging')) {
        const bugDataStr = bugCard.getAttribute('data-bug-data');
        if (bugDataStr) {
          try {
            const bugData = JSON.parse(bugDataStr.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
            showBugDetail(bugData);
          } catch (err) {
            console.error('Error parsing bug data:', err);
          }
        }
      }
    });
    
    function showBugDetail(bug) {
      const modal = document.getElementById('bugDetailModal');
      if (!modal) return;
      
      const tagsHtml = (bug.tags || []).map(tag => 
        '<span class="bug-tag">' + tag + '</span>'
      ).join('');
      
      const statusClass = getStatusClass(bug.status);
      const statusLabel = getStatusLabel(bug.status);
      const priorityColor = getPriorityColor(bug.priority);
      const priorityLabel = getPriorityLabel(bug.priority);
      const bugId = bug.bug_id || bug.id || 'BUG-000';
      const bugUuid = bug.uuid || bug.id;
      
      // Build priority badge style to avoid EJS parsing issues
      const priorityBgColor = priorityColor + '20';
      const priorityBorderColor = priorityColor + '40';
      const priorityStyle = 'background-color: ' + priorityBgColor + '; color: ' + priorityColor + '; border-color: ' + priorityBorderColor + ';';
      
      modal.innerHTML = 
        '<div class="bug-modal-content">' +
          '<div class="bug-modal-header">' +
            '<h2 class="bug-modal-title">' + bugId + '</h2>' +
            '<button class="bug-modal-close" id="bugDetailModalClose">' +
              '<i class="fas fa-times"></i>' +
            '</button>' +
          '</div>' +
          '<div class="bug-detail-section">' +
            '<span class="bug-detail-label">Titel</span>' +
            '<div class="bug-detail-value">' + (bug.title || '-') + '</div>' +
          '</div>' +
          '<div class="bug-detail-section">' +
            '<span class="bug-detail-label">Beschrijving</span>' +
            '<div class="bug-detail-value">' + (bug.description || '-') + '</div>' +
          '</div>' +
          '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">' +
            '<div class="bug-detail-section">' +
              '<span class="bug-detail-label">Status</span>' +
              '<div class="bug-detail-value">' +
                '<span class="status-badge ' + statusClass + '">' + statusLabel + '</span>' +
              '</div>' +
            '</div>' +
            '<div class="bug-detail-section">' +
              '<span class="bug-detail-label">Prioriteit</span>' +
              '<div class="bug-detail-value">' +
                '<span class="status-badge" style="' + priorityStyle + '">' + priorityLabel + '</span>' +
              '</div>' +
            '</div>' +
            '<div class="bug-detail-section">' +
              '<span class="bug-detail-label">Gebied</span>' +
              '<div class="bug-detail-value">' + (bug.area || '-') + '</div>' +
            '</div>' +
            '<div class="bug-detail-section">' +
              '<span class="bug-detail-label">Aangemaakt</span>' +
              '<div class="bug-detail-value">' + formatDate(bug.created_at) + '</div>' +
            '</div>' +
            (bug.fixed_at ? 
              '<div class="bug-detail-section">' +
                '<span class="bug-detail-label">Gefixt op</span>' +
                '<div class="bug-detail-value">' + formatDate(bug.fixed_at) + '</div>' +
              '</div>' : '') +
          '</div>' +
          (tagsHtml ? 
            '<div class="bug-detail-section">' +
              '<span class="bug-detail-label">Tags</span>' +
              '<div class="bug-detail-tags">' + tagsHtml + '</div>' +
            '</div>' : '') +
          // Aangemaakt door (reporter) indien beschikbaar
          (bug.reporter ? 
            '<div class="bug-detail-section">' +
              '<span class="bug-detail-label">Aangemaakt door</span>' +
              '<div class="bug-detail-value">' + (bug.reporter || '-') + '</div>' +
            '</div>' : '') +
          '<div class="bug-modal-actions">' +
            '<button class="btn-danger" id="bugDetailDeleteBtn" data-bug-uuid="' + bugUuid + '"><i class="fas fa-trash"></i> Verwijderen</button>' +
            '<button class="btn-secondary" id="bugDetailCloseBtn">Sluiten</button>' +
          '</div>' +
        '</div>';
      
      modal.classList.add('active');
      
      // Setup event listeners for buttons
      const closeBtn = modal.querySelector('#bugDetailCloseBtn');
      const deleteBtn = modal.querySelector('#bugDetailDeleteBtn');
      
      if (closeBtn) {
        closeBtn.onclick = closeBugDetail;
      }
      
      if (deleteBtn) {
        deleteBtn.onclick = () => {
          deleteBug(deleteBtn.dataset.bugUuid);
        };
      }
      
      const modalCloseBtn = modal.querySelector('#bugDetailModalClose');
      if (modalCloseBtn) {
        modalCloseBtn.onclick = closeBugDetail;
      }
      
      // Close on background click
      const handleDetailModalClick = (e) => {
        // Check if click is on the modal background (not on the content)
        if (e.target === modal) {
          closeBugDetail();
        }
      };
      modal.onclick = handleDetailModalClick;
    }
    
    function closeBugDetail() {
      const modal = document.getElementById('bugDetailModal');
      if (modal) modal.classList.remove('active');
    }
    
    // Make globally available for onclick handlers
    window.closeBugDetail = closeBugDetail;
    
    let pendingDeleteBugUuid = null;
    
    function showDeleteConfirm(bugUuid, bugTitle) {
      pendingDeleteBugUuid = bugUuid;
      const modal = document.getElementById('bugConfirmModal');
      const message = document.getElementById('bugConfirmMessage');
      
      if (bugTitle) {
        message.textContent = 'Weet je zeker dat je "' + bugTitle + '" wilt verwijderen? Deze actie kan niet ongedaan worden gemaakt.';
      } else {
        message.textContent = 'Weet je zeker dat je deze bug wilt verwijderen? Deze actie kan niet ongedaan worden gemaakt.';
      }
      
      if (modal) {
        modal.classList.add('active');
      }
    }
    
    function closeDeleteConfirm() {
      const modal = document.getElementById('bugConfirmModal');
      if (modal) {
        modal.classList.remove('active');
      }
      pendingDeleteBugUuid = null;
    }
    
    async function confirmDeleteBug() {
      if (!pendingDeleteBugUuid) {
        return;
      }
      
      const bugUuid = pendingDeleteBugUuid;
      closeDeleteConfirm();
      
      try {
        const response = await fetch('/admin/api/bugs/' + bugUuid, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const result = await response.json();
        
        if (result.success) {
          closeBugDetail();
          showToast('success', 'Bug verwijderd', 'De bug is succesvol verwijderd.');
          // Remove bug card from DOM
          const bugCard = document.querySelector('[data-bug-uuid="' + bugUuid + '"]');
          if (bugCard) {
            bugCard.remove();
            updateColumnCounts();
          } else {
            // Reload if card not found
            setTimeout(() => {
              window.location.reload();
            }, 500);
          }
        } else {
          showToast('error', 'Fout bij verwijderen', result.error || 'Onbekende fout');
        }
      } catch (error) {
        console.error('Error deleting bug:', error);
        showToast('error', 'Fout bij verwijderen', error.message);
      }
    }
    
    // Setup confirmation modal event listeners
    document.addEventListener('DOMContentLoaded', () => {
      const confirmModal = document.getElementById('bugConfirmModal');
      const cancelBtn = document.getElementById('bugConfirmCancel');
      const deleteBtn = document.getElementById('bugConfirmDelete');
      
      if (cancelBtn) {
        cancelBtn.onclick = closeDeleteConfirm;
      }
      
      if (deleteBtn) {
        deleteBtn.onclick = confirmDeleteBug;
      }
      
      if (confirmModal) {
        confirmModal.onclick = (e) => {
          if (e.target === confirmModal) {
            closeDeleteConfirm();
          }
        };
      }
    });
    
    function deleteBug(bugUuid) {
      // Get bug title for better confirmation message
      const bugCard = document.querySelector('[data-bug-uuid="' + bugUuid + '"]');
      let bugTitle = null;
      if (bugCard) {
        const titleEl = bugCard.querySelector('.bug-card-title');
        if (titleEl) {
          bugTitle = titleEl.textContent.trim();
        }
      }
      showDeleteConfirm(bugUuid, bugTitle);
    }
    
    // Make globally available
    window.deleteBug = deleteBug;
    
    function editBug(bugUuid) {
      // Get bug data
      const bugCard = document.querySelector('[data-bug-uuid="' + bugUuid + '"]');
      if (!bugCard) {
        alert('Bug niet gevonden');
        return;
      }
      
      const bugDataStr = bugCard.getAttribute('data-bug-data');
      if (!bugDataStr) {
        alert('Bug data niet gevonden');
        return;
      }
      
      try {
        const bugData = JSON.parse(bugDataStr.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
        showEditModal(bugData);
      } catch (err) {
        console.error('Error parsing bug data:', err);
        alert('Fout bij laden bug data');
      }
    }
    
    function showEditModal(bug) {
      closeBugDetail();
      
      let editModal = document.getElementById('bugEditModal');
      if (!editModal) {
        // Create edit modal if it doesn't exist
        const modalHTML = 
          '<div id="bugEditModal" class="bug-modal" style="display: none;">' +
            '<div class="bug-modal-content" style="max-width: 600px;">' +
              '<div class="bug-modal-header">' +
                '<h2 class="bug-modal-title">Bug Bewerken</h2>' +
                '<button class="bug-modal-close" id="bugEditModalClose">' +
                  '<i class="fas fa-times"></i>' +
                '</button>' +
              '</div>' +
              '<form id="bugEditForm">' +
                '<div style="margin-bottom: 16px;">' +
                  '<label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Titel *</label>' +
                  '<input type="text" name="title" id="editTitle" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">' +
                '</div>' +
                '<div style="margin-bottom: 16px;">' +
                  '<label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Beschrijving</label>' +
                  '<textarea name="description" id="editDescription" rows="4" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>' +
                '</div>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">' +
                  '<div>' +
                    '<label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Prioriteit</label>' +
                    '<select name="priority" id="editPriority" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">' +
                      '<option value="low">Laag</option>' +
                      '<option value="normal">Normaal</option>' +
                      '<option value="high">Hoog</option>' +
                      '<option value="urgent">Urgent</option>' +
                    '</select>' +
                  '</div>' +
                  '<div>' +
                    '<label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Status</label>' +
                    '<select name="status" id="editStatus" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">' +
                      '<option value="open">Open</option>' +
                      '<option value="in_progress">In behandeling</option>' +
                      '<option value="fixed">Gefixt</option>' +
                      '<option value="closed">Gesloten</option>' +
                    '</select>' +
                  '</div>' +
                '</div>' +
                '<div style="margin-bottom: 16px;">' +
                  '<label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Gebied</label>' +
                  '<input type="text" name="area" id="editArea" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">' +
                '</div>' +
                '<div style="margin-bottom: 24px;">' +
                  '<label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Tags (komma-gescheiden)</label>' +
                  '<input type="text" name="tags" id="editTags" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">' +
                '</div>' +
                '<div style="display: flex; gap: 12px; justify-content: flex-end;">' +
                  '<button type="button" id="bugEditCancel" class="btn-secondary">Annuleren</button>' +
                  '<button type="submit" class="btn-primary">Opslaan</button>' +
                '</div>' +
              '</form>' +
            '</div>' +
          '</div>';
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        editModal = document.getElementById('bugEditModal');
      }
      const form = document.getElementById('bugEditForm');
      
      // Fill form with bug data
      document.getElementById('editTitle').value = bug.title || '';
      document.getElementById('editDescription').value = bug.description || '';
      document.getElementById('editPriority').value = bug.priority || 'normal';
      document.getElementById('editStatus').value = bug.status || 'open';
      document.getElementById('editArea').value = bug.area || '';
      document.getElementById('editTags').value = (bug.tags || []).join(', ');
      
      // Show modal
      editModal.style.display = 'flex';
      
      // Setup close handlers
      document.getElementById('bugEditModalClose').onclick = () => {
        editModal.style.display = 'none';
      };
      
      document.getElementById('bugEditCancel').onclick = () => {
        editModal.style.display = 'none';
      };
      
      // Close on background click
      const handleEditModalClick = (e) => {
        // Check if click is on the modal background (not on the content)
        if (e.target === editModal) {
          editModal.style.display = 'none';
        }
      };
      editModal.onclick = handleEditModalClick;
      
      // Setup form submit
      form.onsubmit = async (e) => {
        e.preventDefault();
        
        const formData = new FormData(form);
        const tagsInput = formData.get('tags');
        const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(Boolean) : [];
        
        const bugData = {
          title: formData.get('title'),
          description: formData.get('description'),
          priority: formData.get('priority'),
          status: formData.get('status'),
          area: formData.get('area'),
          tags: tags
        };
        
        try {
          const bugUuid = bug.uuid || bug.id;
          const response = await fetch('/admin/api/bugs/' + bugUuid, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(bugData)
          });
          
          const result = await response.json();
          
          if (result.success) {
            editModal.style.display = 'none';
            showToast('success', 'Bug bijgewerkt', 'De bug is succesvol bijgewerkt.');
            setTimeout(() => {
              window.location.reload();
            }, 500);
          } else {
            showToast('error', 'Fout bij bijwerken', result.error || 'Onbekende fout');
          }
        } catch (error) {
          console.error('Error updating bug:', error);
          showToast('error', 'Fout bij bijwerken', error.message);
        }
      };
    }
    
    // Make globally available
    window.editBug = editBug;
    
    function getStatusClass(status) {
      const map = { 
        open: 'status-blue', 
        in_progress: 'status-orange', 
        fixed: 'status-success', 
        closed: 'status-gray' 
      };
      return map[status] || 'status-gray';
    }
    
    function getStatusLabel(status) {
      const map = { 
        open: 'Open', 
        in_progress: 'In behandeling', 
        fixed: 'Gefixt', 
        closed: 'Gesloten' 
      };
      return map[status] || 'Open';
    }
    
    function getPriorityColor(priority) {
      const map = {
        low: '#6b7280',
        normal: '#3b82f6',
        high: '#f59e0b',
        urgent: '#ef4444'
      };
      return map[priority] || '#6b7280';
    }
    
    function getPriorityLabel(priority) {
      const map = {
        low: 'Laag',
        normal: 'Normaal',
        high: 'Hoog',
        urgent: 'Urgent'
      };
      return map[priority] || 'Normaal';
    }
    
    function formatDate(iso) {
      if (!iso) return '-';
      const d = new Date(iso);
      return d.toLocaleDateString('nl-NL', { day: '2-digit', month: 'short', year: 'numeric' });
    }
    
    // Use existing notification system
    function showToast(type, title, message, duration = 4000) {
      // Use the existing showNotification function from main.js
      if (typeof window.showNotification === 'function') {
        // If message is provided, use only the message (skip title)
        const fullMessage = message || title;
        window.showNotification(fullMessage, type, duration, false);
      } else {
        // Fallback if showNotification is not available
        console.warn('showNotification not available, using alert fallback');
        alert(message || title);
      }
    }
    
    // Make globally available
    window.showToast = showToast;
    
    // Setup create bug modal
    function setupBugModal() {
      const createBugBtn = document.getElementById('createBugBtn');
      const bugModal = document.getElementById('bugModal');
      const bugModalClose = document.getElementById('bugModalClose');
      const bugForm = document.getElementById('bugForm');
      
      if (!createBugBtn) {
        console.warn('Create bug button not found');
        return;
      }
      
      if (!bugModal) {
        console.warn('Bug modal not found');
        return;
      }
      
      // Remove existing listeners to prevent duplicates
      const newCreateBtn = createBugBtn.cloneNode(true);
      createBugBtn.parentNode.replaceChild(newCreateBtn, createBugBtn);
      
      // Open modal
      newCreateBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        console.log('Create bug button clicked');
        const modal = document.getElementById('bugModal');
        if (modal) {
          modal.style.display = 'flex';
        }
      });
      
      // Close modal handlers
      if (bugModalClose) {
        bugModalClose.onclick = () => {
          bugModal.style.display = 'none';
          if (bugForm) bugForm.reset();
        };
      }
      
      // Close on background click
      bugModal.onclick = (e) => {
        if (e.target === bugModal) {
          bugModal.style.display = 'none';
          if (bugForm) bugForm.reset();
        }
      };
      
      // Cancel button
      const bugModalCancel = document.getElementById('bugModalCancel');
      if (bugModalCancel) {
        bugModalCancel.onclick = () => {
          bugModal.style.display = 'none';
          if (bugForm) bugForm.reset();
        };
      }
      
      // Form submit handler
      if (bugForm) {
        bugForm.onsubmit = async (e) => {
          e.preventDefault();
          
          const formData = new FormData(bugForm);
          const tagsInput = formData.get('tags');
          const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(Boolean) : [];
          
          const bugData = {
            title: formData.get('title'),
            description: formData.get('description'),
            priority: formData.get('priority'),
            status: formData.get('status'),
            area: formData.get('area'),
            tags: tags
          };
          
          try {
            const response = await fetch('/admin/api/bugs', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(bugData)
            });
            
            const result = await response.json();
            
            if (result.success) {
              bugModal.style.display = 'none';
              bugForm.reset();
              showToast('success', 'Bug toegevoegd', 'De bug is succesvol toegevoegd.');
              setTimeout(() => {
                window.location.reload();
              }, 500);
            } else {
              showToast('error', 'Fout bij toevoegen', result.error || 'Onbekende fout');
            }
          } catch (error) {
            console.error('Error creating bug:', error);
            showToast('error', 'Fout bij aanmaken', error.message);
          }
        };
      }
    }
    
    // Setup bug modal multiple times to ensure it works
    function initBugModal() {
      try {
        setupBugModal();
      } catch (e) {
        console.error('Error setting up bug modal:', e);
      }
    }
    
    // Try immediately
    initBugModal();
    
    // Also on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initBugModal);
    }
    
    // Fallback delays
    setTimeout(initBugModal, 100);
    setTimeout(initBugModal, 500);
    setTimeout(initBugModal, 1000);
  </script>
  
  <!-- Bug Modal -->
  <div id="bugModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 12px; padding: 24px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 600;">Nieuwe Bug Toevoegen</h2>
        <button id="bugModalClose" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="bugForm">
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Titel *</label>
          <input type="text" name="title" required style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Beschrijving</label>
          <textarea name="description" rows="4" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
          <div>
            <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Prioriteit</label>
            <select name="priority" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
              <option value="low">Laag</option>
              <option value="normal" selected>Normaal</option>
              <option value="high">Hoog</option>
              <option value="urgent">Urgent</option>
            </select>
          </div>
          
          <div>
            <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Status</label>
            <select name="status" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
              <option value="open" selected>Open</option>
              <option value="in_progress">In behandeling</option>
              <option value="fixed">Gefixt</option>
              <option value="closed">Gesloten</option>
            </select>
          </div>
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Gebied</label>
          <input type="text" name="area" placeholder="Bijv. Onboarding Tour, Dashboard" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
        </div>
        
        <div style="margin-bottom: 24px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 500; color: #374151;">Tags (komma-gescheiden)</label>
          <input type="text" name="tags" placeholder="Bijv. UI, Overlay, Mask" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
          <button type="button" id="bugModalCancel" style="padding: 10px 20px; border: 1px solid #d1d5db; background: white; border-radius: 8px; font-weight: 500; cursor: pointer; color: #374151;">
            Annuleren
          </button>
          <button type="submit" style="padding: 10px 20px; background: #ea5d0d; color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
            Bug Toevoegen
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Bug Detail Modal -->
  <div id="bugDetailModal" class="bug-modal"></div>
  
  <!-- Confirmation Modal -->
  <div id="bugConfirmModal" class="confirm-modal">
    <div class="confirm-modal-content">
      <div class="confirm-modal-header">
        <div class="confirm-modal-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <h3 class="confirm-modal-title">Bug Verwijderen</h3>
      </div>
      <p class="confirm-modal-message" id="bugConfirmMessage">
        Weet je zeker dat je deze bug wilt verwijderen? Deze actie kan niet ongedaan worden gemaakt.
      </p>
      <div class="confirm-modal-actions">
        <button class="btn-secondary" id="bugConfirmCancel">Annuleren</button>
        <button class="btn-danger" id="bugConfirmDelete"><i class="fas fa-trash"></i> Verwijderen</button>
      </div>
    </div>
  </div>
  `,
  stylesheets: (stylesheets || [])
}) %>
